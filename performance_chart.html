<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARG ç½‘ç«™æ€§èƒ½ç›‘æ§å›¾è¡¨</title>
    <!-- å¼•å…¥ ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            text-align: center;
            color: #8892b0;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        /* æ–‡ä»¶é€‰æ‹©åŒºåŸŸ */
        .file-selector {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            border: 2px dashed rgba(100, 255, 218, 0.3);
            transition: all 0.3s ease;
        }
        .file-selector:hover {
            border-color: rgba(100, 255, 218, 0.6);
            background: rgba(255, 255, 255, 0.12);
        }
        .file-selector label {
            color: #64ffda;
            font-size: 16px;
            cursor: pointer;
            display: block;
            padding: 15px;
        }
        .file-selector input[type="file"] {
            display: none;
        }
        .file-name {
            color: #8892b0;
            margin-top: 10px;
            font-size: 14px;
        }
        .file-name.loaded {
            color: #64ffda;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chart {
            width: 100%;
            height: 350px;
        }
        .chart-title {
            color: #fff;
            font-size: 18px;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid #64ffda;
        }
        .summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        .summary-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .summary-card .label {
            color: #8892b0;
            font-size: 14px;
            margin-bottom: 8px;
        }
        .summary-card .value {
            color: #64ffda;
            font-size: 28px;
            font-weight: bold;
        }
        .summary-card .unit {
            color: #8892b0;
            font-size: 14px;
        }
        
        /* éšè—å›¾è¡¨åŒºåŸŸç›´åˆ°åŠ è½½æ•°æ® */
        .charts-area {
            display: none;
        }
        .charts-area.visible {
            display: block;
        }
        
        /* æç¤ºä¿¡æ¯ */
        .hint {
            text-align: center;
            color: #8892b0;
            padding: 40px;
            font-size: 16px;
        }
        .hint i {
            font-size: 48px;
            display: block;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        @media (max-width: 768px) {
            .summary {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ARG ç½‘ç«™æ€§èƒ½ç›‘æ§</h1>
        <p class="subtitle">é€‰æ‹© CSV æ–‡ä»¶æŸ¥çœ‹èµ„æºæ¶ˆè€—æƒ…å†µ</p>
        
        <!-- æ–‡ä»¶é€‰æ‹©å™¨ -->
        <div class="file-selector">
            <label for="csv-file">
                ğŸ“ ç‚¹å‡»é€‰æ‹© CSV æ–‡ä»¶ æˆ– æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„
                <input type="file" id="csv-file" accept=".csv">
            </label>
            <div class="file-name" id="file-name">æ”¯æŒçš„æ–‡ä»¶ï¼šperformance_*.csv</div>
        </div>
        
        <!-- æç¤ºä¿¡æ¯ -->
        <div class="hint" id="hint">
            <div style="font-size: 48px; opacity: 0.5;">ğŸ“Š</div>
            è¯·é€‰æ‹©ä¸€ä¸ª CSV æ€§èƒ½ç›‘æ§æ–‡ä»¶å¼€å§‹åˆ†æ
        </div>
        
        <!-- å›¾è¡¨åŒºåŸŸ -->
        <div class="charts-area" id="charts-area">
            <!-- ç»Ÿè®¡æ‘˜è¦ -->
            <div class="summary">
                <div class="summary-card">
                    <div class="label">CPU å³°å€¼</div>
                    <div class="value" id="cpu-peak">-</div>
                    <div class="unit">%</div>
                </div>
                <div class="summary-card">
                    <div class="label">å†…å­˜å³°å€¼</div>
                    <div class="value" id="mem-peak">-</div>
                    <div class="unit">GB</div>
                </div>
                <div class="summary-card">
                    <div class="label">GPUæ˜¾å­˜å³°å€¼</div>
                    <div class="value" id="gpu-peak">-</div>
                    <div class="unit">MB</div>
                </div>
                <div class="summary-card">
                    <div class="label">ç£ç›˜å†™å…¥æ€»é‡</div>
                    <div class="value" id="disk-total">-</div>
                    <div class="unit">MB</div>
                </div>
            </div>

            <!-- CPU ä½¿ç”¨ç‡å›¾è¡¨ -->
            <div class="chart-container">
                <div class="chart-title">CPU ä½¿ç”¨ç‡ (%)</div>
                <div id="cpu-chart" class="chart"></div>
            </div>

            <!-- å†…å­˜ä½¿ç”¨å›¾è¡¨ -->
            <div class="chart-container">
                <div class="chart-title">å†…å­˜ä½¿ç”¨ (GB)</div>
                <div id="mem-chart" class="chart"></div>
            </div>

            <!-- GPU æ˜¾å­˜å›¾è¡¨ -->
            <div class="chart-container">
                <div class="chart-title">GPU æ˜¾å­˜ä½¿ç”¨ (MB)</div>
                <div id="gpu-chart" class="chart"></div>
            </div>

            <!-- ç£ç›˜ IO å›¾è¡¨ -->
            <div class="chart-container">
                <div class="chart-title">ç£ç›˜å†™å…¥é‡ (MB)</div>
                <div id="disk-chart" class="chart"></div>
            </div>
        </div>
    </div>

    <script>
        // å›¾è¡¨å®ä¾‹
        let cpuChart, memChart, gpuChart, diskChart;
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            cpuChart = echarts.init(document.getElementById('cpu-chart'));
            memChart = echarts.init(document.getElementById('mem-chart'));
            gpuChart = echarts.init(document.getElementById('gpu-chart'));
            diskChart = echarts.init(document.getElementById('disk-chart'));
        }

        // è§£æ CSV æ•°æ®
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                const values = lines[i].split(',');
                const row = {};
                headers.forEach((header, index) => {
                    row[header.trim()] = values[index];
                });
                data.push(row);
            }
            return data;
        }

        // é€šç”¨å›¾è¡¨é…ç½®
        function createChartOption(title, yAxisName, xData, seriesData, color, areaColor) {
            return {
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    borderColor: color,
                    textStyle: { color: '#fff' },
                    formatter: function(params) {
                        const p = params[0];
                        return `æ—¶é—´: ${xData[p.dataIndex]}<br/>${title}: ${p.value.toFixed(2)} ${yAxisName}`;
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '10%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: xData,
                    axisLine: { lineStyle: { color: '#4a5568' } },
                    axisLabel: { color: '#8892b0', fontSize: 11 },
                    splitLine: { show: false }
                },
                yAxis: {
                    type: 'value',
                    name: yAxisName,
                    nameTextStyle: { color: '#8892b0' },
                    axisLine: { lineStyle: { color: '#4a5568' } },
                    axisLabel: { color: '#8892b0' },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } }
                },
                series: [{
                    name: title,
                    type: 'line',
                    smooth: true,
                    symbol: 'none',
                    sampling: 'lttb',
                    itemStyle: { color: color },
                    lineStyle: { width: 2, color: color },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: areaColor },
                            { offset: 1, color: 'rgba(0,0,0,0)' }
                        ])
                    },
                    data: seriesData
                }]
            };
        }

        // æ¸²æŸ“å›¾è¡¨
        function renderCharts(data) {
            // æå–å„é¡¹æ•°æ®
            const elapsedSeconds = data.map(d => Math.round(parseFloat(d.elapsed_seconds)) + 's');
            const cpuData = data.map(d => parseFloat(d.cpu_percent) || 0);
            const memData = data.map(d => parseFloat(d.mem_used_gb) || 0);
            const gpuMemData = data.map(d => parseFloat(d.gpu_mem_used_mb) || 0);
            const diskWriteData = data.map(d => (parseFloat(d.disk_write_total) || 0) / 1024 / 1024);

            // è®¡ç®—å³°å€¼å¹¶æ›´æ–°æ‘˜è¦
            document.getElementById('cpu-peak').textContent = Math.max(...cpuData).toFixed(1);
            document.getElementById('mem-peak').textContent = Math.max(...memData).toFixed(2);
            document.getElementById('gpu-peak').textContent = Math.max(...gpuMemData).toFixed(0);
            document.getElementById('disk-total').textContent = Math.max(...diskWriteData).toFixed(0);

            // è®¾ç½®å„å›¾è¡¨é…ç½®
            cpuChart.setOption(createChartOption('CPUä½¿ç”¨ç‡', '%', elapsedSeconds, cpuData, '#ff6b6b', 'rgba(255, 107, 107, 0.3)'));
            memChart.setOption(createChartOption('å†…å­˜ä½¿ç”¨', 'GB', elapsedSeconds, memData, '#4ecdc4', 'rgba(78, 205, 196, 0.3)'));
            gpuChart.setOption(createChartOption('GPUæ˜¾å­˜', 'MB', elapsedSeconds, gpuMemData, '#a855f7', 'rgba(168, 85, 247, 0.3)'));
            diskChart.setOption(createChartOption('ç£ç›˜å†™å…¥', 'MB', elapsedSeconds, diskWriteData, '#f59e0b', 'rgba(245, 158, 11, 0.3)'));
        }

        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFile(file) {
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const csvContent = e.target.result;
                const data = parseCSV(csvContent);
                
                if (data.length === 0) {
                    alert('CSV æ–‡ä»¶ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®');
                    return;
                }
                
                // æ˜¾ç¤ºæ–‡ä»¶å
                document.getElementById('file-name').textContent = 'å·²åŠ è½½: ' + file.name + ' (' + data.length + ' æ¡è®°å½•)';
                document.getElementById('file-name').classList.add('loaded');
                
                // éšè—æç¤ºï¼Œæ˜¾ç¤ºå›¾è¡¨
                document.getElementById('hint').style.display = 'none';
                document.getElementById('charts-area').classList.add('visible');
                
                // åˆå§‹åŒ–å¹¶æ¸²æŸ“å›¾è¡¨
                if (!cpuChart) {
                    initCharts();
                }
                renderCharts(data);
                
                // è§¦å‘ resize ç¡®ä¿å›¾è¡¨æ­£ç¡®æ˜¾ç¤º
                setTimeout(() => {
                    cpuChart.resize();
                    memChart.resize();
                    gpuChart.resize();
                    diskChart.resize();
                }, 100);
            };
            reader.readAsText(file);
        }

        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        document.getElementById('csv-file').addEventListener('change', function(e) {
            handleFile(e.target.files[0]);
        });

        // æ‹–æ‹½æ”¯æŒ
        const fileSelector = document.querySelector('.file-selector');
        
        fileSelector.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.borderColor = 'rgba(100, 255, 218, 0.8)';
            this.style.background = 'rgba(100, 255, 218, 0.1)';
        });
        
        fileSelector.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.style.borderColor = 'rgba(100, 255, 218, 0.3)';
            this.style.background = 'rgba(255, 255, 255, 0.08)';
        });
        
        fileSelector.addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.borderColor = 'rgba(100, 255, 218, 0.3)';
            this.style.background = 'rgba(255, 255, 255, 0.08)';
            
            const file = e.dataTransfer.files[0];
            if (file && file.name.endsWith('.csv')) {
                handleFile(file);
            } else {
                alert('è¯·é€‰æ‹© CSV æ–‡ä»¶');
            }
        });

        // å“åº”çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', function() {
            if (cpuChart) {
                cpuChart.resize();
                memChart.resize();
                gpuChart.resize();
                diskChart.resize();
            }
        });
    </script>
</body>
</html>
